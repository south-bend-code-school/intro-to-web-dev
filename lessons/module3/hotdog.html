<!DOCTYPE html>
<html>
    <head>
        <title>Hot dogs == sandwiches?</title>
        <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
    </head>
    <body>
        <h1 id="hotDogOutput">Hot dog status:</h1>
        <input type="textfield" id="latestHotDogStatus"/>
        <button id="saveButton">Save</button>
        <button id="loadButton">Load</button>

        <!--Unlike the video tutorial, we are keeping all our javascript inline in our html file.-->
        <script>

            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyCzd22PWoCipek5E-7qDx-WfFmBO0hjb6g",
                authDomain: "intro-to-webdev-chat-app.firebaseapp.com",
                projectId: "intro-to-webdev-chat-app",
                storageBucket: "intro-to-webdev-chat-app.appspot.com",
                messagingSenderId: "556658533694",
                appId: "1:556658533694:web:d26d93919b6280d7efb86f"
            };

            // Initialize our application
            firebase.initializeApp(firebaseConfig);
            var firestore = firebase.firestore();

            const docRef = firestore.doc("sample/sandwichdata")
            const outputHandler = document.getElementById("hotDogOutput")
            const inputTextField = document.getElementById("latestHotDogStatus")
            const saveButton = document.getElementById("saveButton")
            const loadButton = document.getElementById("loadButton")

            saveButton.addEventListener("click", function() {
                const textToSave = inputTextField.value;

                docRef.set({
                    hotDogStatus: textToSave
                }).then(function() {
                    console.log("Status Saved!");
                }).catch(function(error){
                    console.log("Got and error:", error);
                });
            })

            loadButton.addEventListener("click", function() {
                docRef.get().then(function (doc) {
                    if(doc && doc.data) {
                        const myData = doc.data();
                        outputHandler.innerText = "Hot Dog status: " + myData.hotDogStatus;
                    }
                }).catch(function (error) {
                    console.log("Got an error:", error)
                });
            });

            getRealTimeUpdates = function() {
                docRef.onSnapshot(function (doc) {
                    if(doc && doc.data) {
                        const myData = doc.data();
                        outputHandler.innerText = "Hot Dog status: " + myData.hotDogStatus;
                    }
                });
            }

            getRealTimeUpdates();
            
        </script>
    </body>
</html>